# ADR-002: Template Propagation & AI-First Documentation

**Status:** Partially Implemented  
**Date:** 2025-06-11  
**Updated:** 2025-06-14  
**Context:** Self-propagating AI intelligence network through template system

## Decision

Implement template propagation system that automatically creates and maintains AI-optimized documentation across workspaces, enabling cross-project intelligence sharing.

## Architecture

### Template Hierarchy
```
~/.kingly/templates/           # Global templates
‚îú‚îÄ‚îÄ CLAUDE.md.template         # Project instruction template
‚îú‚îÄ‚îÄ README.agent.template      # Agent-first README template
‚îú‚îÄ‚îÄ ADR.template              # Architecture decision template
‚îî‚îÄ‚îÄ SESSION.template          # Session handoff template

$PWD/.kingly/templates/       # Project-specific overrides
‚îú‚îÄ‚îÄ local.CLAUDE.md.template
‚îî‚îÄ‚îÄ context.SESSION.template
```

### Core Commands

#### `kingly-semantic template init`
**Purpose:** Initialize workspace with AI-first templates  
**Variables:** `--workspace-type`, `--intelligence-level`, `--propagation-mode`  
**Output:** Created template files with AI optimization

```bash
kingly-semantic template init --workspace-type="development" --intelligence-level="high"
```

#### `kingly-semantic template sync`
**Purpose:** Synchronize templates across related workspaces  
**Variables:** `--target-workspace`, `--sync-level`, `--merge-strategy`  
**Output:** Template diff and sync status

```bash
kingly-semantic template sync --target-workspace="../related-project"
```

#### `kingly-semantic template evolve`
**Purpose:** AI-driven template improvement based on usage patterns  
**Variables:** `--usage-data`, `--intelligence-feedback`, `--evolution-mode`  
**Output:** Evolved template with improvement rationale

```bash
kingly-semantic template evolve --usage-data="last-30-days" --evolution-mode="auto"
```

## Template Components

### CLAUDE.md.template
```markdown
# {{PROJECT_NAME}} - AI Intelligence Configuration

## Workspace Intelligence Level: {{INTELLIGENCE_LEVEL}}
{{#if PARENT_WORKSPACE}}
**Parent System:** {{PARENT_WORKSPACE}}
**Intelligence Inheritance:** {{INTELLIGENCE_INHERITANCE}}
{{/if}}

## Session Commands
### Auto-Ping Triggers
- {{AUTO_PING_TRIGGERS}}

### Cross-Workspace Routing  
- {{CROSS_WORKSPACE_ROUTES}}

## Context Propagation
{{CONTEXT_PROPAGATION_RULES}}

## Intelligence Patterns
{{INTELLIGENCE_PATTERNS}}

---
*Generated by Kingly Template System v{{VERSION}}*
*Last Evolution: {{LAST_EVOLUTION_DATE}}*
```

### README.agent.template
```markdown
# {{PROJECT_NAME}}

## AI Agent Instructions
This README is designed for AI agents. Human documentation follows.

### Quick Intelligence Access
- **Context Type:** {{CONTEXT_TYPE}}
- **Intelligence Triggers:** {{INTELLIGENCE_TRIGGERS}}
- **Cross-References:** {{CROSS_REFERENCES}}

### Agent Workflow Integration
{{AGENT_WORKFLOWS}}

### Session Handoff Points
{{SESSION_HANDOFF_POINTS}}

## Human Documentation
{{HUMAN_DOCUMENTATION}}

---
*AI-Optimized Documentation via Kingly Templates*
```

## BDD Scenarios

```gherkin
Feature: Template Propagation
  Scenario: Initialize AI-first workspace
    Given empty workspace directory
    When kingly-semantic template init is executed
    Then CLAUDE.md is created with AI optimization
    And README.md includes agent instructions
    And template inheritance is established

  Scenario: Cross-workspace synchronization
    Given source workspace with evolved templates  
    When template sync targets related workspace
    Then templates are intelligently merged
    And intelligence patterns are preserved
    And sync history is tracked

  Scenario: Template evolution
    Given template with usage tracking
    When evolution threshold is reached
    Then AI analyzes usage patterns
    And generates improved template
    And backwards compatibility is maintained
```

## Integration Points

### With Session Intelligence (ADR-001)
- Templates include session checkpoint configurations
- Handoff templates are workspace-aware
- Cross-workspace routing through template inheritance

### With Claude Code Slash Commands
- Templates define available slash commands
- Command behavior inherits from template patterns
- Template evolution driven by command usage

### With Distributed Intelligence Network
- Templates serve as intelligence propagation vectors
- Cross-workspace intelligence sharing through template sync
- AI-first documentation enables agent collaboration

## Template Variables

### Global Variables
- `{{PROJECT_NAME}}` - Project identifier
- `{{INTELLIGENCE_LEVEL}}` - AI optimization level (basic/standard/high/expert)
- `{{WORKSPACE_TYPE}}` - Type classification (development/research/production)
- `{{VERSION}}` - Template system version
- `{{LAST_EVOLUTION_DATE}}` - Last AI-driven improvement

### Context Variables  
- `{{PARENT_WORKSPACE}}` - Parent system reference
- `{{INTELLIGENCE_INHERITANCE}}` - Inherited intelligence patterns
- `{{CROSS_WORKSPACE_ROUTES}}` - Inter-workspace connections
- `{{CONTEXT_PROPAGATION_RULES}}` - How context flows

### Dynamic Variables
- `{{AUTO_PING_TRIGGERS}}` - Generated from usage patterns
- `{{INTELLIGENCE_TRIGGERS}}` - AI-detected important moments
- `{{AGENT_WORKFLOWS}}` - Available agent interactions
- `{{SESSION_HANDOFF_POINTS}}` - Natural transition points

## Consequences

**Positive:**
- Self-propagating AI intelligence network
- Consistent AI optimization across workspaces
- Reduced manual documentation maintenance
- Cross-project intelligence sharing
- Agent-first design patterns

**Negative:**
- Template complexity overhead
- Risk of over-automation
- Template versioning challenges
- Potential intelligence pattern conflicts

## Implementation Status

‚úÖ **Completed:**
1. Core template system - Templates exist in `/templates/` directory
2. Basic template files - ADR.template, CLAUDE.md.template, README.agent.template, SESSION.template
3. Template integration - Referenced in session management and intelligence coordinator

üîÑ **In Progress:**
1. Template synchronization between workspaces - Basic concepts implemented
2. Variable substitution system - Partial implementation in tooling

‚è≥ **Not Implemented:**
1. AI-driven template evolution - Design phase only
2. Cross-workspace intelligence routing via templates - Future enhancement
3. Advanced template inheritance and conflict resolution - Future enhancement

## Success Metrics

- Template adoption rate across workspaces
- Reduction in manual documentation tasks
- Cross-workspace intelligence sharing frequency
- Template evolution effectiveness
- Agent workflow integration success rate